<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Check danh s√°ch UID</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      padding: 12px 10px;
      font-size: 16px;
    }
    textarea, button {
      margin-bottom: 10px;
    }
    textarea {
      width: 100%;
      height: 100px;
      font-family: monospace;
      padding: 8px;
      border-radius: 6px;
    }
    button {
      padding: 12px 20px;
      font-size: 15px;
      margin-right: 10px;
    }
    .table-wrapper {
      max-height: 400px;
      overflow-y: auto;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      margin-top: 20px;
    }
    table {
      width: 100%;
      min-width: 600px;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px 6px;
      text-align: center;
    }
    th {
      background-color: #007bff;
      color: white;
      position: sticky;
      top: 0;
    }
    .live {
      background-color: #d4edda;
    }
    .die {
      background-color: #f8d7da;
    }
  </style>
</head>
<body>
  <h3>‚úÖ Check UID Facebook t·ª´ token</h3>

  <label>Danh s√°ch UID (m·ªói d√≤ng 1 UID):</label>
  <textarea id="uids" placeholder="1000xxxxxxxxxx"></textarea>

  <label>Danh s√°ch Token (m·ªói d√≤ng 1 token):</label>
  <textarea id="tokens" placeholder="EAAG..."></textarea>

  <button onclick="checkTokensLive()">‚úÖ Check Token Live</button>
  <button onclick="startCheck()">üöÄ B·∫Øt ƒë·∫ßu Check UID</button>
  <button id="copyBtn">üìã Copy k·∫øt qu·∫£</button>

  <p><strong>Token Live:</strong> <span id="liveCount">0</span></p>
  <p><strong>UID ƒë√£ check:</strong> <span id="checkedCount">0</span></p>

  <div class="table-wrapper">
    <table id="result">
      <thead>
        <tr>
          <th>UID</th>
          <th>T√™n</th>
          <th>V·ªã tr√≠</th>
          <th>Email</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

<script>
  let liveTokens = [];

  async function isTokenLive(token) {
    try {
      const res = await fetch(`https://graph.facebook.com/me?access_token=${token}`);
      const json = await res.json();
      return !!json.id;
    } catch {
      return false;
    }
  }

  async function checkTokensLive() {
    const input = document.getElementById("tokens");
    const tokens = input.value.trim().split("\n").map(t => t.trim()).filter(Boolean);
    liveTokens = [];

    for (const token of tokens) {
      if (await isTokenLive(token)) liveTokens.push(token);
    }

    input.value = liveTokens.join("\n");
    document.getElementById("liveCount").innerText = liveTokens.length;
    alert("‚úÖ ƒê√£ l·ªçc xong token live!");
  }

  async function fetchUserInfo(uid, token) {
    const fields = "name,location,hometown,email";
    const url = `https://graph.facebook.com/${uid}?fields=${fields}&access_token=${token}`;
    const res = await fetch(url);
    return res.json();
  }

  async function handleUID(uid, token, tbody) {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${uid}</td><td colspan="3">‚è≥ ƒêang t·∫£i...</td>`;
    tbody.appendChild(tr);

    try {
      const data = await fetchUserInfo(uid, token);
      if (data.error) {
        tr.className = "die";
        tr.innerHTML = `<td>${uid}</td><td colspan="3">‚ùå ${data.error.message}</td>`;
      } else {
        tr.className = "live";
        tr.innerHTML = `
          <td>${uid}</td>
          <td>${data.name || "Kh√¥ng r√µ"}</td>
          <td>${data.location?.name || "Kh√¥ng r√µ"} | ${data.hometown?.name || "Kh√¥ng r√µ"}</td>
          <td>${data.email || "Kh√¥ng c√≥"}</td>
        `;
      }
    } catch {
      tr.className = "die";
      tr.innerHTML = `<td>${uid}</td><td colspan="3">‚ùå L·ªói kh√¥ng x√°c ƒë·ªãnh</td>`;
    }

    updateCheckedCount();
  }

  function updateCheckedCount() {
    const count = document.querySelectorAll("#result tbody tr").length;
    document.getElementById("checkedCount").innerText = count;
  }

  async function startCheck() {
    const uids = document.getElementById("uids").value.trim().split("\n").filter(Boolean);
    const tbody = document.querySelector("#result tbody");
    tbody.innerHTML = "";

    if (!uids.length) return alert("‚ùå Nh·∫≠p danh s√°ch UID!");
    if (!liveTokens.length) return alert("‚ùå Ch∆∞a c√≥ token live! Vui l√≤ng check token tr∆∞·ªõc.");

    const batchSize = 10;
    let index = 0;

    while (index < uids.length) {
      const batch = uids.slice(index, index + batchSize);
      await Promise.all(batch.map((uid, i) => {
        const token = liveTokens[(index + i) % liveTokens.length];
        return handleUID(uid, token, tbody);
      }));
      index += batchSize;
      await new Promise(r => setTimeout(r, 600));
    }
  }

  document.getElementById("copyBtn").addEventListener("click", () => {
    const rows = document.querySelectorAll("#result tbody tr");
    if (!rows.length) return alert("‚ùå Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ copy!");

    let text = "UID|T√™n|V·ªã tr√≠|Email\n";
    rows.forEach(row => {
      const cells = row.querySelectorAll("td");
      const line = Array.from(cells).map(td => td.innerText.trim()).join("|");
      text += line + "\n";
    });

    navigator.clipboard.writeText(text)
      .then(() => alert("‚úÖ ƒê√£ sao ch√©p k·∫øt qu·∫£ v√†o clipboard!"))
      .catch(() => alert("‚ùå Kh√¥ng th·ªÉ sao ch√©p."));
  });
</script>
</body>
</html>
