<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>GitHub File Manager</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
<style>
body { background:#f9f9f9; font-family: monospace; }
header { background:#212529; color:white; padding:10px; text-align:center; font-size:1.2em; }
#loginBox, #fileManager { max-width:900px; margin:20px auto; background:white; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1); padding:20px; }
#fileList td { vertical-align: middle; }
.folder { color:#007bff; }
.file { color:#495057; }
.notice { margin-top:10px; }
</style>
</head>
<body>

<header>ğŸ“ GitHub File Manager</header>

<div id="loginBox">
  <h5>ğŸ” Káº¿t ná»‘i Ä‘áº¿n Repository</h5>
  <div class="mb-2">
    <label>ğŸ‘¤ Username</label>
    <input id="user" class="form-control" placeholder="vd: volamtuan">
  </div>
  <div class="mb-2">
    <label>ğŸ“¦ Repository</label>
    <input id="repo" class="form-control" placeholder="vd: volamtuan.github.io">
  </div>
  <div class="mb-2">
    <label>ğŸ”‘ GitHub Token</label>
    <input id="token" class="form-control" placeholder="Personal Access Token (PAT)">
  </div>
  <button class="btn btn-primary w-100" id="connectBtn">Káº¿t ná»‘i Repository</button>
</div>

<div id="fileManager" style="display:none;">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h5>ğŸ“‚ <span id="currentPath">/</span></h5>
    <div>
      <button class="btn btn-success btn-sm" id="newFolderBtn"><i class="bi bi-folder-plus"></i> Táº¡o thÆ° má»¥c</button>
      <button class="btn btn-primary btn-sm" id="newFileBtn"><i class="bi bi-file-earmark-plus"></i> Táº¡o file</button>
      <button class="btn btn-danger btn-sm" id="logoutBtn"><i class="bi bi-box-arrow-right"></i> ÄÄƒng xuáº¥t</button>
    </div>
  </div>
  <table class="table table-hover" id="fileList">
    <thead><tr><th>TÃªn</th><th>KÃ­ch thÆ°á»›c</th><th>HÃ nh Ä‘á»™ng</th></tr></thead>
    <tbody></tbody>
  </table>
  <div class="notice" id="status"></div>
</div>

<script>
const apiBase = "https://api.github.com";
let user, repo, token, path = "";

function saveConfig() {
  localStorage.setItem("gh_user", user);
  localStorage.setItem("gh_repo", repo);
  localStorage.setItem("gh_token", token);
}
function loadConfig() {
  user = localStorage.getItem("gh_user");
  repo = localStorage.getItem("gh_repo");
  token = localStorage.getItem("gh_token");
  return user && repo && token;
}

async function github(method, endpoint, body=null) {
  const res = await fetch(`${apiBase}${endpoint}`, {
    method,
    headers: {
      "Authorization": "token " + token,
      "Accept": "application/vnd.github+json"
    },
    body: body ? JSON.stringify(body) : null
  });
  if (!res.ok) throw new Error(res.status + " " + res.statusText);
  return await res.json();
}

async function listFiles() {
  document.getElementById("status").innerText = "ğŸ”„ Äang táº£i...";
  try {
    const files = await github("GET", `/repos/${user}/${repo}/contents/${path}`);
    const tbody = document.querySelector("#fileList tbody");
    tbody.innerHTML = "";
    files.forEach(f=>{
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td><i class="bi ${f.type==="dir"?"bi-folder-fill folder":"bi-file-earmark file"}"></i> 
          <a href="#" onclick="openPath('${f.path}')">${f.name}</a></td>
        <td>${f.size || "-"}</td>
        <td>
          <button class="btn btn-sm btn-danger" onclick="deleteItem('${f.path}','${f.sha}')"><i class="bi bi-trash"></i></button>
        </td>`;
      tbody.appendChild(tr);
    });
    document.getElementById("status").innerText = "âœ… HoÃ n táº¥t!";
  } catch(e){
    document.getElementById("status").innerText = "âŒ Lá»—i: " + e.message;
  }
}

async function openPath(newPath) {
  path = newPath;
  document.getElementById("currentPath").innerText = "/" + path;
  await listFiles();
}

async function deleteItem(p, sha) {
  if (!confirm("XoÃ¡ " + p + " ?")) return;
  try {
    await github("DELETE", `/repos/${user}/${repo}/contents/${p}`, { message: "delete "+p, sha });
    document.getElementById("status").innerText = "ğŸ—‘ï¸ ÄÃ£ xoÃ¡ " + p;
    await listFiles();
  } catch(e){ document.getElementById("status").innerText = "âŒ Lá»—i xoÃ¡: " + e.message; }
}

async function createItem(type) {
  const name = prompt(`Nháº­p tÃªn ${type==='dir'?'thÆ° má»¥c':'file'}`);
  if (!name) return;
  try {
    if (type === "dir") {
      await github("PUT", `/repos/${user}/${repo}/contents/${path}/${name}/.keep`, {
        message: "create folder " + name,
        content: btoa("")
      });
    } else {
      await github("PUT", `/repos/${user}/${repo}/contents/${path}/${name}`, {
        message: "create file " + name,
        content: btoa("")
      });
    }
    document.getElementById("status").innerText = "âœ… ÄÃ£ táº¡o " + name;
    await listFiles();
  } catch(e){ document.getElementById("status").innerText = "âŒ Lá»—i táº¡o: " + e.message; }
}

document.getElementById("connectBtn").onclick = async ()=>{
  user=document.getElementById("user").value.trim();
  repo=document.getElementById("repo").value.trim();
  token=document.getElementById("token").value.trim();
  if(!user||!repo||!token)return alert("Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§!");
  saveConfig();
  document.getElementById("loginBox").style.display="none";
  document.getElementById("fileManager").style.display="block";
  await listFiles();
};

document.getElementById("newFolderBtn").onclick=()=>createItem("dir");
document.getElementById("newFileBtn").onclick=()=>createItem("file");
document.getElementById("logoutBtn").onclick=()=>{
  localStorage.clear();
  location.reload();
};

if(loadConfig()){
  document.getElementById("loginBox").style.display="none";
  document.getElementById("fileManager").style.display="block";
  listFiles();
}
</script>

</body>
</html>
