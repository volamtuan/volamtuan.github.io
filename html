<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Qu·∫£n l√Ω Multi-Tab Runner</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { padding:20px; font-family: Arial; background:#f9f9f9; }
textarea { width:100%; height:150px; font-family: monospace; margin-bottom:5px; }
iframe { width:100%; height:200px; border:1px solid #ccc; margin-top:5px; }
.nav-tabs { margin-bottom:5px; }
.nav-item { position:relative; }
.close-btn { position:absolute; top:0; right:0; font-size:14px; color:red; cursor:pointer; }
#dropzone { border:2px dashed #0d6efd; padding:20px; text-align:center; color:#0d6efd; margin-bottom:10px; }
#dropzone.dragover { background:#e3f2fd; }
.console { background:#1e1e1e; color:#fff; padding:5px; font-size:14px; height:100px; overflow:auto; margin-top:5px; }
#copyMessage { display:inline-block; margin-left:10px; color:green; font-weight:bold; opacity:0; transition: opacity 0.3s ease; }
</style>
</head>
<body>
<div class="container">
<h2 class="mb-3">Qu·∫£n l√Ω Domain & Multi-Tab HTML/JS Runner</h2>

<!-- Domain Management -->
<div class="mb-3">
<label>Domain list:</label>
<textarea id="domainList" placeholder="Nh·∫≠p danh s√°ch domain, m·ªói d√≤ng m·ªôt domain"></textarea>
<button class="btn btn-primary btn-sm" onclick="copyDomains()">üìã Copy t·∫•t c·∫£</button>
<span id="copyMessage">ƒê√£ copy!</span>
</div>

<hr>

<!-- Multi-tab Runner -->
<div class="mb-3">
<button class="btn btn-success btn-sm" onclick="addTab()">‚ûï Th√™m Tab</button>
<input type="file" id="htmlUpload" accept=".html" class="form-control d-inline-block w-auto ms-2">
<button class="btn btn-warning btn-sm" onclick="downloadBackup()">üì• L∆∞u Backup</button>
<button class="btn btn-danger btn-sm" onclick="clearAll()">üóëÔ∏è Xo√° t·∫•t c·∫£</button>
</div>

<div id="dropzone">K√©o & th·∫£ file HTML v√†o ƒë√¢y</div>
<ul class="nav nav-tabs" id="tabHeaders"></ul>
<div id="tabContents"></div>
</div>

<script>
let tabCount=0;

// Copy domain list
function copyDomains(){
    const domains=document.getElementById('domainList').value;
    navigator.clipboard.writeText(domains).then(()=>{
        const msg=document.getElementById('copyMessage');
        msg.style.opacity=1;
        setTimeout(()=>{msg.style.opacity=0;},1000);
    });
}

// -------- Multi-tab Runner --------
function activateTab(id){
    document.querySelectorAll('.tab-pane').forEach(d=>d.classList.remove('active'));
    document.querySelectorAll('.nav-link').forEach(a=>a.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.getElementById(id+'-link').classList.add('active');
}

function addTab(title="Tab", code=""){
    tabCount++;
    const tabId='tab'+tabCount;

    const li=document.createElement('li');
    li.className='nav-item';
    li.innerHTML=`<a class="nav-link" id="${tabId}-link" onclick="activateTab('${tabId}')">üíª ${title}</a>
                  <span class="close-btn" onclick="removeTab('${tabId}')">‚ùå</span>`;
    document.getElementById('tabHeaders').appendChild(li);

    const div=document.createElement('div');
    div.className='tab-pane active';
    div.id=tabId;
    div.innerHTML=`
<textarea id="code${tabCount}">${code}</textarea>
<div class="mb-2">
<button class="btn btn-success btn-sm" onclick="runCode(${tabCount})">‚ñ∂ Ch·∫°y</button>
<button class="btn btn-info btn-sm" onclick="viewHTML(${tabCount})">üëÅÔ∏è Xem HTML</button>
</div>
<iframe id="iframe${tabCount}"></iframe>
<div class="console" id="console${tabCount}">Console...</div>`;
    document.getElementById('tabContents').appendChild(div);

    document.getElementById('code'+tabCount).addEventListener('input', saveAllTabs);
    activateTab(tabId);
    saveAllTabs();
}

function removeTab(id){
    document.getElementById(id).remove();
    document.getElementById(id+'-link').parentElement.remove();
    saveAllTabs();
}

function runCode(num){
    const code=document.getElementById('code'+num).value;
    const iframe=document.getElementById('iframe'+num);
    const consoleDiv=document.getElementById('console'+num);
    consoleDiv.innerHTML='';

    const blob=new Blob([`
        <script>
        console.log=function(...args){
            parent.document.getElementById('${consoleDiv.id}').innerHTML+=args.join(' ')+'<br>';
        };
        try{ ${code} } catch(e){ console.log('Error:',e); }
        <\/script>`],{type:'text/html'});
    const url=URL.createObjectURL(blob);
    iframe.src=url;
    saveAllTabs();
}

function viewHTML(num){
    const code=document.getElementById('code'+num).value;
    const win=window.open("","_blank","width=800,height=600,scrollbars=yes");
    win.document.write("<pre>"+code.replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</pre>");
    win.document.title="HTML Tab "+num;
}

// -------- LocalStorage --------
function saveAllTabs(){
    let data=[];
    document.querySelectorAll('.tab-pane').forEach(div=>{
        const num=div.id.replace('tab','');
        const ta=document.getElementById('code'+num);
        if(ta) data.push({title: document.getElementById(div.id+'-link').textContent, code: ta.value});
    });
    localStorage.setItem('tabsData',JSON.stringify(data));
}

function loadTabs(){
    const saved=localStorage.getItem('tabsData');
    if(saved){
        try{
            const tabs=JSON.parse(saved);
            tabs.forEach(t=>addTab(t.title,t.code));
        }catch{ addTab(); }
    }else{ addTab(); }
}

// -------- Backup --------
function downloadBackup(){
    const saved=localStorage.getItem('tabsData');
    if(!saved){ alert("Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ l∆∞u!"); return; }
    const blob=new Blob([saved],{type:'application/json'});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a');
    a.href=url; a.download='backup_tabs.json'; a.click();
    URL.revokeObjectURL(url);
}

// -------- Clear all --------
function clearAll(){
    if(confirm("Xo√° t·∫•t c·∫£ d·ªØ li·ªáu ƒë√£ l∆∞u?")){
        localStorage.removeItem('tabsData');
        document.getElementById('tabHeaders').innerHTML="";
        document.getElementById('tabContents').innerHTML="";
        tabCount=0;
        addTab();
    }
}

// -------- Upload HTML file ----------
document.getElementById('htmlUpload').addEventListener('change', e=>{
    const file=e.target.files[0];
    if(!file) return;
    const reader=new FileReader();
    reader.onload=evt=>addTab(file.name,evt.target.result);
    reader.readAsText(file,'UTF-8');
});

// -------- Drag & Drop ----------
const dropzone=document.getElementById('dropzone');
dropzone.addEventListener('dragover', e=>{e.preventDefault(); dropzone.classList.add('dragover');});
dropzone.addEventListener('dragleave', e=>{dropzone.classList.remove('dragover');});
dropzone.addEventListener('drop', e=>{
    e.preventDefault(); dropzone.classList.remove('dragover');
    const file=e.dataTransfer.files[0];
    if(!file) return;
    const reader=new FileReader();
    reader.onload=evt=>addTab(file.name,evt.target.result);
    reader.readAsText(file,'UTF-8');
});

window.onload=loadTabs;
</script>
</body>
</html>
